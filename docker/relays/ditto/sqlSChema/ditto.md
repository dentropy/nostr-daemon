<!--

classDiagram
class kysely_migration{
 *VARCHAR<255> name NOT NULL
   VARCHAR<255> timestamp NOT NULL
}
class kysely_migration_lock{
 *VARCHAR<255> id NOT NULL
   INTEGER is_locked NOT NULL
}
class event_zaps{
 *TEXT receipt_id NOT NULL
   INTEGER amount_millisats NOT NULL
   TEXT comment NOT NULL
   TEXT sender_pubkey NOT NULL
   TEXT target_event_id NOT NULL
}
class push_subscriptions{
 *BIGINT id NOT NULL
   TEXT auth NOT NULL
   TIMESTAMP created_at NOT NULL
   JSONB data
   TEXT endpoint NOT NULL
   TEXT p256dh NOT NULL
   CHAR<64> pubkey NOT NULL
   BYTEA token_hash NOT NULL
   TIMESTAMP updated_at NOT NULL
}
class auth_tokens{
 *BYTEA token_hash NOT NULL
   CHAR<64> bunker_pubkey NOT NULL
   TIMESTAMP created_at
   JSONB nip46_relays
   BYTEA nip46_sk_enc NOT NULL
   CHAR<64> pubkey NOT NULL
}
class nostr_events{
 *CHAR<64> id NOT NULL
   TEXT content NOT NULL
   BIGINT created_at NOT NULL
   TEXT d
   INTEGER kind NOT NULL
   CHAR<64> pubkey NOT NULL
   TSVECTOR search
   JSONB search_ext NOT NULL
   CHAR<128> sig NOT NULL
   JSONB tags NOT NULL
   JSONB tags_index NOT NULL
}
class author_stats{
 *CHAR<64> pubkey NOT NULL
   INTEGER followers_count NOT NULL
   INTEGER following_count NOT NULL
   VARCHAR<320> nip05
   VARCHAR<253> nip05_domain
   VARCHAR<253> nip05_hostname
   INTEGER nip05_last_verified_at
   INTEGER notes_count NOT NULL
   TEXT search NOT NULL
   INTEGER streak_end
   INTEGER streak_start
}
class domain_favicons{
 *VARCHAR<253> domain NOT NULL
   VARCHAR<2048> favicon NOT NULL
   INTEGER last_updated_at NOT NULL
}
class event_stats{
 *CHAR<64> event_id NOT NULL
   JSONB link_preview
   INTEGER quotes_count NOT NULL
   TEXT reactions
   INTEGER reactions_count NOT NULL
   INTEGER replies_count NOT NULL
   INTEGER reposts_count NOT NULL
   INTEGER zaps_amount NOT NULL
   INTEGER zaps_amount_cashu NOT NULL
}
auth_tokens "1" -- "0..n" push_subscriptions

-->
![](https://mermaid.ink/img/Y2xhc3NEaWFncmFtCmNsYXNzIGt5c2VseV9taWdyYXRpb257CiAqVkFSQ0hBUjwyNTU-IG5hbWUgTk9UIE5VTEwKICAgVkFSQ0hBUjwyNTU-IHRpbWVzdGFtcCBOT1QgTlVMTAp9CmNsYXNzIGt5c2VseV9taWdyYXRpb25fbG9ja3sKICpWQVJDSEFSPDI1NT4gaWQgTk9UIE5VTEwKICAgSU5URUdFUiBpc19sb2NrZWQgTk9UIE5VTEwKfQpjbGFzcyBldmVudF96YXBzewogKlRFWFQgcmVjZWlwdF9pZCBOT1QgTlVMTAogICBJTlRFR0VSIGFtb3VudF9taWxsaXNhdHMgTk9UIE5VTEwKICAgVEVYVCBjb21tZW50IE5PVCBOVUxMCiAgIFRFWFQgc2VuZGVyX3B1YmtleSBOT1QgTlVMTAogICBURVhUIHRhcmdldF9ldmVudF9pZCBOT1QgTlVMTAp9CmNsYXNzIHB1c2hfc3Vic2NyaXB0aW9uc3sKICpCSUdJTlQgaWQgTk9UIE5VTEwKICAgVEVYVCBhdXRoIE5PVCBOVUxMCiAgIFRJTUVTVEFNUCBjcmVhdGVkX2F0IE5PVCBOVUxMCiAgIEpTT05CIGRhdGEKICAgVEVYVCBlbmRwb2ludCBOT1QgTlVMTAogICBURVhUIHAyNTZkaCBOT1QgTlVMTAogICBDSEFSPDY0PiBwdWJrZXkgTk9UIE5VTEwKICAgQllURUEgdG9rZW5faGFzaCBOT1QgTlVMTAogICBUSU1FU1RBTVAgdXBkYXRlZF9hdCBOT1QgTlVMTAp9CmNsYXNzIGF1dGhfdG9rZW5zewogKkJZVEVBIHRva2VuX2hhc2ggTk9UIE5VTEwKICAgQ0hBUjw2ND4gYnVua2VyX3B1YmtleSBOT1QgTlVMTAogICBUSU1FU1RBTVAgY3JlYXRlZF9hdAogICBKU09OQiBuaXA0Nl9yZWxheXMKICAgQllURUEgbmlwNDZfc2tfZW5jIE5PVCBOVUxMCiAgIENIQVI8NjQ-IHB1YmtleSBOT1QgTlVMTAp9CmNsYXNzIG5vc3RyX2V2ZW50c3sKICpDSEFSPDY0PiBpZCBOT1QgTlVMTAogICBURVhUIGNvbnRlbnQgTk9UIE5VTEwKICAgQklHSU5UIGNyZWF0ZWRfYXQgTk9UIE5VTEwKICAgVEVYVCBkCiAgIElOVEVHRVIga2luZCBOT1QgTlVMTAogICBDSEFSPDY0PiBwdWJrZXkgTk9UIE5VTEwKICAgVFNWRUNUT1Igc2VhcmNoCiAgIEpTT05CIHNlYXJjaF9leHQgTk9UIE5VTEwKICAgQ0hBUjwxMjg-IHNpZyBOT1QgTlVMTAogICBKU09OQiB0YWdzIE5PVCBOVUxMCiAgIEpTT05CIHRhZ3NfaW5kZXggTk9UIE5VTEwKfQpjbGFzcyBhdXRob3Jfc3RhdHN7CiAqQ0hBUjw2ND4gcHVia2V5IE5PVCBOVUxMCiAgIElOVEVHRVIgZm9sbG93ZXJzX2NvdW50IE5PVCBOVUxMCiAgIElOVEVHRVIgZm9sbG93aW5nX2NvdW50IE5PVCBOVUxMCiAgIFZBUkNIQVI8MzIwPiBuaXAwNQogICBWQVJDSEFSPDI1Mz4gbmlwMDVfZG9tYWluCiAgIFZBUkNIQVI8MjUzPiBuaXAwNV9ob3N0bmFtZQogICBJTlRFR0VSIG5pcDA1X2xhc3RfdmVyaWZpZWRfYXQKICAgSU5URUdFUiBub3Rlc19jb3VudCBOT1QgTlVMTAogICBURVhUIHNlYXJjaCBOT1QgTlVMTAogICBJTlRFR0VSIHN0cmVha19lbmQKICAgSU5URUdFUiBzdHJlYWtfc3RhcnQKfQpjbGFzcyBkb21haW5fZmF2aWNvbnN7CiAqVkFSQ0hBUjwyNTM-IGRvbWFpbiBOT1QgTlVMTAogICBWQVJDSEFSPDIwNDg-IGZhdmljb24gTk9UIE5VTEwKICAgSU5URUdFUiBsYXN0X3VwZGF0ZWRfYXQgTk9UIE5VTEwKfQpjbGFzcyBldmVudF9zdGF0c3sKICpDSEFSPDY0PiBldmVudF9pZCBOT1QgTlVMTAogICBKU09OQiBsaW5rX3ByZXZpZXcKICAgSU5URUdFUiBxdW90ZXNfY291bnQgTk9UIE5VTEwKICAgVEVYVCByZWFjdGlvbnMKICAgSU5URUdFUiByZWFjdGlvbnNfY291bnQgTk9UIE5VTEwKICAgSU5URUdFUiByZXBsaWVzX2NvdW50IE5PVCBOVUxMCiAgIElOVEVHRVIgcmVwb3N0c19jb3VudCBOT1QgTlVMTAogICBJTlRFR0VSIHphcHNfYW1vdW50IE5PVCBOVUxMCiAgIElOVEVHRVIgemFwc19hbW91bnRfY2FzaHUgTk9UIE5VTEwKfQphdXRoX3Rva2VucyAiMSIgLS0gIjAuLm4iIHB1c2hfc3Vic2NyaXB0aW9ucw==)
